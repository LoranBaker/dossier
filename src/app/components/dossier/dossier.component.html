<!-- dossier.component.html -->
<div class="dossier-container">
<!-- Updated print section with restructured button content -->
<div class="print-section">
  <button class="print-button" (click)="printDossier('kunde')" aria-label="Dossier f√ºr Kunde drucken">
    <span class="print-text">
      <span class="print-icon">üñ®Ô∏è</span>
      <span class="print-main">Drucken</span>
      <span class="print-label">Kunde</span>
    </span>
  </button>
  
  <button class="print-button" (click)="printDossier('lv')" aria-label="LV-Verzeichnis drucken">
    <span class="print-text">
      <span class="print-icon">üñ®Ô∏è</span>
      <span class="print-main">Drucken</span>
      <span class="print-label">LV-Verz.</span>
    </span>
  </button>
  
  <button class="print-button" (click)="printDossier('bank')" aria-label="Bank-Dokument drucken">
    <span class="print-text">
      <span class="print-icon">üñ®Ô∏è</span>
      <span class="print-main">Drucken</span>
      <span class="print-label">Bank</span>
    </span>
  </button>

  <!-- <button class="print-button" (click)="printScreenshotDossier()" aria-label="Dossier als Screenshot-PDF drucken">
    <span class="print-text">
      <span class="print-icon">üñºÔ∏è</span>
      <span class="print-main">Screenshots</span>
      <span class="print-label">PDF</span>
    </span>
  </button> -->
</div>
  <!-- Header Section -->
  <header class="dossier-header">
    <div class="logo">ENVALPRO</div>
    <h1 class="title">GEB√ÑUDEANALYSE DER {{building.address | uppercase}}</h1>
    <h2 class="subtitle">ENERGIEEFFIZIENZ ‚Äì F√ñRDERUNG - POTENTIAL</h2>
  </header>

 <!-- 3D Building Model Section - Full Width -->
  <div class="building-model-section">
    <!-- Loading State -->
    <div *ngIf="loading3DModel" class="model-loading">
      <div class="loading-spinner"></div>
      <p>3D-Modell wird geladen...</p>
    </div>

    <!-- 3D Model Viewer - Full Width Container -->
    <div *ngIf="has3DModel && !loading3DModel" class="model-viewer-container">
      <app-simple3d-model 
        [address]="building.address"
        [buildingId]="buildingId"
        (screenshotsChanged)="onScreenshotsChanged($event)">
      </app-simple3d-model>
    </div>

    <!-- No Model Available -->
    <div *ngIf="!has3DModel && !loading3DModel" class="no-model-container">
    </div>
  </div>

<!-- Navigation Tabs -->
<div class="tabs-container">
<button 
  class="tab-scroll-button tab-scroll-left" 
  [class.disabled]="isScrolledToStart" 
  (click)="scrollTabs('left')" 
  aria-label="Scroll tabs left">
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="15 18 9 12 15 6"></polyline>
  </svg>
</button>

<div #tabsWrapper class="tabs-wrapper">
  <div #tabsContent class="tabs" [class.scrolled]="scrolled">
    <button [class.active]="activeTab === 'overview'" (click)="setActiveTab('overview')">√úbersicht</button>
    <button [class.active]="activeTab === 'buildingData'" (click)="setActiveTab('buildingData')">Geb√§udedaten</button>
    <button [class.active]="activeTab === 'consumption'" (click)="setActiveTab('consumption')">Verbrauch & ESG</button>
    <button [class.active]="activeTab === 'analysis'" (click)="setActiveTab('analysis')">Bestandsanalyse</button>
    <button [class.active]="activeTab === 'renovation'" (click)="setActiveTab('renovation')">Sanierungsma√ünahmen</button>
    <button [class.active]="activeTab === 'timeline'" (click)="setActiveTab('timeline')">iSFP-Fahrplan</button>
    <button [class.active]="activeTab === 'targetAnalysis'" (click)="setActiveTab('targetAnalysis')">Analyse des Zielzustandes</button>
    <button [class.active]="activeTab === 'financialPotential'" (click)="setActiveTab('financialPotential')">
      Finanzielles Potential
    </button>
    <button [class.active]="activeTab === 'renovationResults'" (click)="setActiveTab('renovationResults')">Ergebnisse Sanierung</button>
    <button [class.active]="activeTab === 'financialBenefits'" (click)="setActiveTab('financialBenefits')">
      Finanzielle Vorteile
    </button>
    <button [class.active]="activeTab === 'financingCalculator'" (click)="setActiveTab('financingCalculator')">
      Finanzierungsrechner
    </button>
    <button [class.active]="activeTab === 'summary'" (click)="setActiveTab('summary')">
      Zusammenfassung
    </button>
    <button [class.active]="activeTab === 'modernizationPlanning'" (click)="setActiveTab('modernizationPlanning')">
      Modernisierungsplanung
    </button>
    <button [class.active]="activeTab === 'consultationCta'" (click)="setActiveTab('consultationCta')">
    Beratung
    </button>
    <button [class.active]="activeTab === 'generalInfo'" (click)="setActiveTab('generalInfo')">
      Allgemeine Hinweise
    </button>
  </div>
</div>

<button 
  class="tab-scroll-button tab-scroll-right" 
  [class.disabled]="isScrolledToEnd" 
  (click)="scrollTabs('right')" 
  aria-label="Scroll tabs right">
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</button>
</div>

  <!-- Tab Content Components using async pipe where appropriate -->
  <div class="tab-content" [@tabAnimation] *ngIf="activeTab === 'overview'">
    <app-overview-tab></app-overview-tab>
  </div>

  <div class="tab-content" [@tabAnimation] *ngIf="activeTab === 'buildingData'">
    <app-building-data-tab 
      [building]="building">
    </app-building-data-tab>
  </div>

  <div class="tab-content" [@tabAnimation] *ngIf="activeTab === 'consumption'">
  <app-consumption-tab 
    [consumptionData]="consumptionData"
    [building]="building"
    (co2TaxDataChanged)="onCO2TaxDataChanged($event)">
  </app-consumption-tab>
</div>

  <div class="tab-content" [@tabAnimation] *ngIf="activeTab === 'analysis'">
    <app-analysis-tab
      [totalRenovationCosts]="totalCosts">
    </app-analysis-tab>
  </div>

  <div class="tab-content" [@tabAnimation] *ngIf="activeTab === 'renovation'">
    <app-renovation-tab 
      [renovationMeasures]="renovationMeasures"
      [savingsPotential]="savingsPotential"
      [amortizationYears]="currentAmortizationYears"
      [foerderboniMeasures]="foerderboniMeasures"
      (totalsChanged)="onRenovationTotalsChanged($event)">
    </app-renovation-tab>
  </div>

  <div class="tab-content" [@tabAnimation] *ngIf="activeTab === 'timeline'">
    <app-timeline-tab 
      [renovationPlan]="renovationPlan"
      [renovationMeasures]="renovationMeasures">
    </app-timeline-tab>
  </div>

  <div class="tab-content" [@tabAnimation] *ngIf="activeTab === 'targetAnalysis'">
    <app-target-analysis-tab
      [renovationMeasures]="renovationMeasures"
      [totalSavings]="totalSavings">
    </app-target-analysis-tab>
  </div>

  <div class="tab-content" [@tabAnimation] *ngIf="activeTab === 'financialPotential'">
    <app-financial-potential-tab
    [renovationMeasures]="renovationMeasures"
    [totalCosts]="totalCosts"
    [totalFunding]="totalFunding"
    [totalSavingsFromRenovation]="totalSavings"
    [consumptionData]="consumptionData"
    [building]="building"
    (dataChanged)="onFinancialPotentialDataChanged($event)">
  </app-financial-potential-tab>
  </div>
  <div class="tab-content" [@tabAnimation] *ngIf="activeTab === 'renovationResults'">
  <app-renovation-results-tab
    [consumptionData]="consumptionData"
    [renovationMeasures]="renovationMeasures"
    [savingsPotential]="savingsPotential"
    [totalCosts]="totalCosts"
    [totalFunding]="totalFunding"
    [co2TaxFromConsumption]="co2TaxData"
    (savingsPercentagesChanged)="onRenovationResultsSavingsChanged($event)">
  </app-renovation-results-tab>
</div>
  <div class="tab-content" [@tabAnimation] *ngIf="activeTab === 'financialBenefits'">
    <app-financial-benefits-tab
      [renovationMeasures]="renovationMeasures"
      [totalCosts]="totalCosts"
      [totalFunding]="totalFunding"
     [consumptionData]="consumptionData"
      [financialPotentialData]="financialPotentialData">
    </app-financial-benefits-tab>
  </div>
  <div class="tab-content" [@tabAnimation] *ngIf="activeTab === 'financingCalculator'">
    <app-financing-calculator
    [initialTotalCosts]="totalCosts"
    [initialTotalFunding]="totalFunding"
    [initialTotalSavings]="totalSavings"
    [financialPotentialData]="financialPotentialData">
  </app-financing-calculator>
  </div>
  <div class="tab-content" [@tabAnimation] *ngIf="activeTab === 'summary'">
    <div class="tab-content" [@tabAnimation] *ngIf="activeTab === 'summary'">
     <app-summary-tab
      [building]="building"
      [consumptionData]="consumptionData"
      [renovationMeasures]="renovationMeasures"
      [savingsPotential]="savingsPotential"
      [totalCosts]="totalCosts"
      [totalFunding]="totalFunding"
      [totalSavings]="totalSavings"
      [financialData]="financialData">
    </app-summary-tab>
    </div>
  </div>
  <div class="tab-content" [@tabAnimation] *ngIf="activeTab === 'modernizationPlanning'">
    <app-modernization-planning></app-modernization-planning>
  </div>
  <div class="tab-content" [@tabAnimation] *ngIf="activeTab === 'consultationCta'">
    <app-consultation-cta></app-consultation-cta>
  </div>
  <div class="tab-content" [@tabAnimation] *ngIf="activeTab === 'generalInfo'">
  <app-general-info></app-general-info>
  </div>
  <!-- Footer Section -->
  <footer class="dossier-footer">
    <div class="footer-logo">ENVALPRO</div>
    <div class="footer-website">www.envalpro.com</div>
  </footer>
</div>