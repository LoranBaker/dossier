<div class="financing-calculator-section">
  <div class="financing-header">
    <h2>Was kosten mich die Vorteile?</h2>
    <div class="financing-edit-controls">
      <button *ngIf="!isEditing" class="financing-edit-button" (click)="toggleEdit()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
        </svg>
        Bearbeiten
      </button>
      <div *ngIf="isEditing" class="financing-action-buttons">
        <button class="financing-cancel-button" (click)="cancelEdit()">Abbrechen</button>
        <button class="financing-save-button" (click)="saveChanges()">Speichern</button>
      </div>
      <div class="financing-saved-message" [class.show]="showSavedMessage">Änderungen gespeichert!</div>
    </div>
  </div>

  <p>Bitte setzen Sie sich mit unseren Finanzierungsexperten zusammen. Wir helfen Ihnen gerne und suchen aus <strong>über 500 Banken</strong> das passende Angebot für Sie heraus.</p>

<div class="bank-icons">
  <div class="bank-icon">
    <div class="icon">
      <img src="bank-logos/Deutsche_Bank.png" alt="Deutsche Bank Logo" class="bank-logo">
    </div>
    <div class="bank-text">Deutsche Bank</div>
  </div>
  <div class="bank-icon">
    <div class="icon">
      <img src="bank-logos/Volksbank.png" alt="Volksbank Logo" class="bank-logo">
    </div>
    <div class="bank-text">Volksbank</div>
  </div>
  <div class="bank-icon">
    <div class="icon">
      <img src="bank-logos/DSL_Bank.png" alt="DSL Bank Logo" class="bank-logo">
    </div>
    <div class="bank-text">DSL Bank</div>
  </div>
  <div class="bank-icon">
    <div class="icon">
      <img src="bank-logos/DKB.png" alt="DKB Logo" class="bank-logo">
    </div>
    <div class="bank-text">DKB</div>
  </div>
  <div class="bank-icon">
    <div class="icon">
      <img src="bank-logos/BW_Bank.png" alt="BW Bank Logo" class="bank-logo">
    </div>
    <div class="bank-text">BW Bank</div>
  </div>
  <div class="bank-icon">
    <div class="icon">
      <img src="bank-logos/Sparkasse.png" alt="Sparkasse Logo" class="bank-logo">
    </div>
    <div class="bank-text">Sparkasse</div>
  </div>
</div>

  <div class="financing-data-table">
    <div class="financing-table-section">
      <div class="financing-section-title">Kann ich mir eine Finanzierung leisten?</div>
      
      <div class="financing-table-content">
        <div class="financing-info">
          <div class="financing-info-row">
            <div class="financing-label">Gesamtkosten der Sanierung</div>
            <div class="financing-value">{{ totalCosts | currency:'EUR':'symbol':'1.0-0' }}</div>
          </div>
          
          <div class="financing-info-row">
            <div class="financing-label">Förderung</div>
            <div class="financing-value">{{ totalFunding | currency:'EUR':'symbol':'1.0-0' }}</div>
          </div>
          
          <div class="financing-info-row financing-highlight-row">
            <div class="financing-label">Effektive Kosten / Eigenanteil*</div>
            <div class="financing-value">{{ effectiveCosts | currency:'EUR':'symbol':'1.0-0' }}</div>
          </div>
          
          <div class="financing-info-row">
            <div class="financing-label">Eigenkapital in €</div>
            <div class="financing-value">{{ ownCapital | currency:'EUR':'symbol':'1.0-0' }}</div>
          </div>
          
          <div class="financing-info-row">
            <div class="financing-label">Eigenkapital in % (auf Sanierung nach Förderung)</div>
            <div class="financing-value">{{ ownCapitalPercentage }}%</div>
          </div>
          
          <div class="financing-info-row financing-highlight-row">
            <div class="financing-label">Finanzierungsbedarf</div>
            <div class="financing-value">{{ financingNeeds | currency:'EUR':'symbol':'1.0-0' }}</div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="financing-table-section">
      <div class="financing-section-title">Einsparung Energiekosten mtl.</div>
      
      <div class="financing-table-content">
        <div class="financing-savings-info">
          <div class="financing-info-row">
            <div class="financing-label">Ersparnis</div>
            <div class="financing-value">
              
              <span class="financing-annual-note">({{ annualSavings | currency:'EUR':'symbol':'1.0-0' }} p.a.)</span>
              <strong> {{ monthlySavings | currency:'EUR':'symbol':'1.0-0' }}</strong>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="financing-table-section">
      <div class="financing-section-title">Weitere Einsparungen mtl.</div>
      
      <div class="financing-table-content">
        <div class="financing-additional-savings-info">
          <div class="financing-info-row">
            <div class="financing-label">Modernisierungsumlage (für 12,5 Jahre)</div>
            <div class="financing-value">
              <span class="financing-annual-note">({{ modernisierungsumlage * 12 | currency:'EUR':'symbol':'1.0-0' }} p.a.)</span>
              {{ modernisierungsumlage | currency:'EUR':'symbol':'1.0-0' }}
            </div>
          </div>
          
          <div class="financing-info-row">
            <div class="financing-label">Einnahmen aus dem Verkauf des nicht selbst verbrauchten PV-Stroms</div>
            <div class="financing-value">
              <span *ngIf="!isEditing">{{ pvStromVerkauf | currency:'EUR':'symbol':'1.0-0' }}</span>
              <div *ngIf="isEditing" class="financing-input-group">
                <input type="number" class="financing-edit-input" [(ngModel)]="editData.pvStromVerkauf">
                <span>€</span>
              </div>
            </div>
          </div>
          
          <div class="financing-info-row">
            <div class="financing-label">CO2-Steuer Ersparnis</div>
            <div class="financing-value">
              <span class="financing-annual-note">({{ co2TaxSavingsAnnual | currency:'EUR':'symbol':'1.0-0' }} p.a.) </span>
              <span *ngIf="!isEditing">{{ co2TaxSavings | currency:'EUR':'symbol':'1.0-0' }}</span>
              <div *ngIf="isEditing" class="financing-input-group">
                <input type="number" class="financing-edit-input" [(ngModel)]="editData.co2TaxSavings">
                <span>€</span>
              </div>
              
            </div>
          </div>
          
          <div class="financing-info-row">
            <div class="financing-label">Summe weiterer Ersparnisse</div>
            <div class="financing-value"><strong>{{ additionalSavingsTotal | currency:'EUR':'symbol':'1.0-0' }}</strong></div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="financing-table-section financing-total-savings">
      <div class="financing-section-title">Summe aller Ersparnisse & Einnahmen mtl.</div>
      <div class="financing-total-value">+{{ totalSavingsMonthly | currency:'EUR':'symbol':'1.0-0' }}</div>
    </div>
    <br>
    <div class="financing-table-section">
      <div class="financing-section-title">Wunschfinanzierung <span class="financing-section-note">(Konditionsbeispiel ohne KfW-Kredit)</span></div>
      <div class="financing-note">(bei nur 10% Eigenkap. und ohne mögl. KfW-Kredit u. Tilgungszuschuss berechnet)</div>
      
      <div class="financing-table-content">
        <div class="financing-loan-options">
          <div class="financing-loan-option">
            <div class="financing-loan-details">
              <div class="financing-loan-row">
                <div class="financing-label">Monatliche Rate für Darlehen <span class="financing-interest-note">(mit 4,9% Zinsen berechnet)*</span></div>
                <div class="financing-value financing-monthly-rate">
                  <span *ngIf="!isEditing">{{ monthlyRate10Years | currency:'EUR':'symbol':'1.0-0' }}</span>
                  <div *ngIf="isEditing" class="financing-input-group">
                    <input type="number" class="financing-edit-input" [(ngModel)]="editData.monthlyRate10Years">
                    <span>€</span>
                  </div>
                </div>
              </div>
              
              <div class="financing-loan-row">
                <div class="financing-label">Kreditlaufzeit</div>
                <div class="financing-value">{{ loanTerm10 }} Jahre</div>
              </div>
              
              <div class="financing-loan-note">*Konditionen können je nach Alter, Bonität, Bank und Situation abweichen</div>
              <div class="financing-rate-note">*(Rate ohne Ersparnisse, Einnahmen & Umlagen)</div>
            </div>
          </div>
          
          <!-- <div class="financing-loan-option">
            <div class="financing-loan-details">
              <div class="financing-loan-row">
                <div class="financing-label">Monatliche Rate für Darlehen <span class="financing-interest-note">(mit 4,9% Zinsen berechnet)*</span></div>
                <div class="financing-value financing-monthly-rate">
                  <span *ngIf="!isEditing">{{ monthlyRate15Years | currency:'EUR':'symbol':'1.0-0' }}</span>
                  <div *ngIf="isEditing" class="financing-input-group">
                    <input type="number" class="financing-edit-input" [(ngModel)]="editData.monthlyRate15Years">
                    <span>€</span>
                  </div>
                </div>
              </div>
              
              <div class="financing-loan-row">
                <div class="financing-label">Kreditlaufzeit</div>
                <div class="financing-value">{{ loanTerm15 }} Jahre</div>
              </div>
              
              <div class="financing-loan-note">*Kondition können je nach Alter, Bonität, Bank und Situation abweichen</div>
              <div class="financing-rate-note">*(Rate ohne Ersparnisse, Einnahmen & Umlagen)</div>
            </div>
          </div> -->
          
          <!-- <div class="financing-loan-option">
            <div class="financing-loan-details">
              <div class="financing-loan-row">
                <div class="financing-label">Monatliche Rate für Darlehen <span class="financing-interest-note">(mit 4,9% Zinsen berechnet)*</span></div>
                <div class="financing-value financing-monthly-rate">
                  <span *ngIf="!isEditing">{{ monthlyRate20Years | currency:'EUR':'symbol':'1.0-0' }}</span>
                  <div *ngIf="isEditing" class="financing-input-group">
                    <input type="number" class="financing-edit-input" [(ngModel)]="editData.monthlyRate20Years">
                    <span>€</span>
                  </div>
                </div>
              </div>
              
              <div class="financing-loan-row">
                <div class="financing-label">Kreditlaufzeit</div>
                <div class="financing-value">{{ loanTerm20 }} Jahre</div>
              </div>
              
              <div class="financing-loan-note">*Kondition können je nach Alter, Bonität, Bank und Situation abweichen</div>
              <div class="financing-rate-note">*(Rate ohne Ersparnisse, Einnahmen & Umlagen)</div>
            </div>
          </div> -->
        </div>
      </div>
    </div>
    
    <div class="financing-final-note">
      Ihr monatlicher Kapitaldienst setzt sich aus der endgültigen Finanzierungsrate, abzüglich der Summe aller tatsächlichen Ersparnisse & Einnahmen zusammen!
    </div>
  </div>
</div>