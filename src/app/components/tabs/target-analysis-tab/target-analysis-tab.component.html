<div class="target-analysis-section">
  <!-- Edit Controls -->
  <div class="target-analysis-edit-controls">
    <button *ngIf="!isEditing" class="target-analysis-edit-button" (click)="toggleEdit()">
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
      </svg>
      Bearbeiten
    </button>
    <div *ngIf="isEditing" class="target-analysis-action-buttons">
      <button class="target-analysis-cancel-button" (click)="cancelEdit()">Abbrechen</button>
      <button class="target-analysis-save-button" (click)="saveChanges()">Speichern</button>
    </div>
    <div class="target-analysis-saved-message" [class.show]="showSavedMessage">Änderungen gespeichert!</div>
  </div>

   <!-- Measurement Stats and Add Back Controls -->
  <div class="measurement-controls" *ngIf="isEditing">
    <div class="measurement-stats">
<span class="visible-count">{{getVisibleMeasurementsCount()}} von {{getTotalMeasurementsCount()}} Maßnahmen sichtbar</span>
    </div>
    
    <div class="add-measurement-controls" *ngIf="hasHiddenMeasurements()">
      <div class="add-back-dropdown" [class.open]="showAddMeasurementDropdown">
        <button class="add-back-button" (click)="toggleAddMeasurementDropdown()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M12 8v8M8 12h8"></path>
          </svg>
          Maßnahme hinzufügen
          <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 9l6 6 6-6"></path>
          </svg>
        </button>
        
        <div class="dropdown-menu" *ngIf="showAddMeasurementDropdown">
          <div class="dropdown-header">
            <span>Versteckte Maßnahmen:</span>
          </div>
          <button 
            *ngFor="let measurement of getHiddenMeasurements()" 
            class="dropdown-item"
            (click)="measurementVisibility[measurement.key] = true; showAddMeasurementDropdown = false">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 6L9 17l-5-5"></path>
            </svg>
            {{measurement.name}}
          </button>
          
          <div class="dropdown-divider"></div>
          
          <button class="dropdown-item show-all" (click)="showAllMeasurements()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            Alle anzeigen
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Mode Instructions -->
  <div *ngIf="isEditing" class="edit-instructions">
    <p>Klicken Sie auf die Maßnahmen, um sie ein- oder auszublenden:</p>
  </div>


  <div class="target-measures">
    <!-- Heizungstechnik -->
    <div class="measure-card" 
         *ngIf="measurementVisibility['heizungstechnik']"
         [class.editing]="isEditing"
         (click)="toggleMeasurement('heizungstechnik')">
      <div class="measure-icon heating-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M32,12v40 M24,16v32 M40,16v32"/>
          <path d="M24,48c-4.4,0-8-3.6-8-8V24c0-4.4,3.6-8,8-8h16c4.4,0,8,3.6,8,8v16c0,4.4-3.6,8-8,8H24z"/>
          <path d="M20,28c0-1.1,0.9-2,2-2s2,0.9,2,2v8c0,1.1-0.9,2-2,2s-2-0.9-2-2V28z"/>
          <path d="M28,28c0-1.1,0.9-2,2-2s2,0.9,2,2v8c0,1.1-0.9,2-2,2s-2-0.9-2-2V28z"/>
          <path d="M36,28c0-1.1,0.9-2,2-2s2,0.9,2,2v8c0,1.1-0.9,2-2,2s-2-0.9-2-2V28z"/>
        </svg>
      </div>
      <div class="measure-content">
        <h3>Heizungstechnik</h3>
        <p>
          Durch die Nutzung von Außenluft als Wärmequelle arbeiten Luft-Wasser-Wärmepumpen sehr effizient, 
          insbesondere in milderen Klimazonen. Für jede Einheit an elektrischer Energie, kann die Wärmepumpe mehrere 
          Einheiten an Wärmeenergie erzeugen. In Kombination mit einer PV-Anlage erreiche Sie bis zu 70% Autarkie!
        </p>
      </div>
      <div *ngIf="isEditing" class="edit-toggle-indicator">✓</div>
    </div>
    
    <!-- Kellerdecke -->
    <div class="measure-card" 
         *ngIf="measurementVisibility['kellerdecke']"
         [class.editing]="isEditing"
         (click)="toggleMeasurement('kellerdecke')">
      <div class="measure-icon basement-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <rect x="10" y="20" width="44" height="24" rx="2" ry="2"/>
          <path d="M14,30h36 M14,40h36"/>
          <path d="M10,20c0,0,0-6,8-6h28c8,0,8,6,8,6"/>
          <path d="M54,44v2c0,2-2,4-4,4H14c-2,0-4-2-4-4v-2"/>
        </svg>
      </div>
      <div class="measure-content">
        <h3>Kellerdecke</h3>
        <p>
          Durch die gedämmte Kellerdecke oder Kellerboden verhindern Sie unnötige Wärmeverluste an den unbeheizten 
          Kellerbereich oder an das Erdreich darunter und erhöhen Ihr Wohlbefinden (keine Fußkälte), den Wohnkomfort und 
          senken den Energieverbrauch.
        </p>
      </div>
      <div *ngIf="isEditing" class="edit-toggle-indicator">✓</div>
    </div>
    
    <!-- Dach -->
    <div class="measure-card" 
         *ngIf="measurementVisibility['dach']"
         [class.editing]="isEditing"
         (click)="toggleMeasurement('dach')">
      <div class="measure-icon roof-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M8,32L32,12L56,32"/>
          <path d="M16,28v20h32V28"/>
          <path d="M28,48v-8c0-2.2,1.8-4,4-4h0c2.2,0,4,1.8,4,4v8"/>
        </svg>
      </div>
      <div class="measure-content">
        <h3>Dach</h3>
        <p>
          Durch ein gut gedämmtes Dach verringert sich der Transmissionswärmeverlust dieses Bauteils drastisch.
        </p>
      </div>
      <div *ngIf="isEditing" class="edit-toggle-indicator">✓</div>
    </div>
    
    <!-- Fassade -->
    <div class="measure-card" 
         *ngIf="measurementVisibility['fassade']"
         [class.editing]="isEditing"
         (click)="toggleMeasurement('fassade')">
      <div class="measure-icon facade-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <rect x="14" y="12" width="36" height="40"/>
          <line x1="26" y1="12" x2="26" y2="52"/>
          <line x1="38" y1="12" x2="38" y2="52"/>
          <line x1="14" y1="22" x2="50" y2="22"/>
          <line x1="14" y1="32" x2="50" y2="32"/>
          <line x1="14" y1="42" x2="50" y2="42"/>
        </svg>
      </div>
      <div class="measure-content">
        <h3>Fassade</h3>
        <p>
          Durch das Aufbringen eines Wärmedämmverbundsystems verringern sich die Transmissionswärmeverluste der 
          Fassadenfläche und somit auch der Energiebedarf des Gebäudes extrem.
        </p>
      </div>
      <div *ngIf="isEditing" class="edit-toggle-indicator">✓</div>
    </div>
    
    <!-- Fenster & Türen -->
    <div class="measure-card" 
         *ngIf="measurementVisibility['fenster-tueren']"
         [class.editing]="isEditing"
         (click)="toggleMeasurement('fenster-tueren')">
      <div class="measure-icon window-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <rect x="12" y="16" width="40" height="32" rx="2" ry="2"/>
          <path d="M32,16v32 M12,32h40"/>
          <rect x="16" y="36" width="12" height="8" rx="1" ry="1"/>
          <circle cx="44" cy="40" r="2"/>
        </svg>
      </div>
      <div class="measure-content">
        <h3>Fenster & Türen</h3>
        <p>
          Durch Fenster & Türen mit einer guten Verglasung und einem gut gedämmten Rahmen, können die Energieeffizienz 
          steigern, Transmissionswärmeverluste verringern und somit positiv zum energetischen Zustand der 
          Immobilie beitragen.
        </p>
      </div>
      <div *ngIf="isEditing" class="edit-toggle-indicator">✓</div>
    </div>
    
    <!-- Lüftungsanlage -->
    <div class="measure-card" 
         *ngIf="measurementVisibility['luftungsanlage']"
         [class.editing]="isEditing"
         (click)="toggleMeasurement('luftungsanlage')">
      <div class="measure-icon ventilation-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <rect x="12" y="20" width="40" height="24" rx="2" ry="2"/>
          <path d="M16,28h32 M16,32h32 M16,36h32"/>
          <path d="M20,16v4 M28,16v4 M36,16v4 M44,16v4"/>
          <path d="M20,44v4 M28,44v4 M36,44v4 M44,44v4"/>
          <circle cx="24" cy="32" r="2"/>
          <circle cx="40" cy="32" r="2"/>
          <path d="M22,30l4,4 M38,30l4,4"/>
        </svg>
      </div>
      <div class="measure-content">
        <h3>Lüftungsanlage</h3>
        <p>
          Eine Lüftungsanlage bietet ein konstantes, angenehmes Raumklima, Schutz vor Schimmelbildung, 
          Energieeinsparungen durch Wärmerückgewinnung und eine verbesserte Luftqualität. Zudem 
          vorteilhaft für Allergiker.
        </p>
      </div>
      <div *ngIf="isEditing" class="edit-toggle-indicator">✓</div>
    </div>
    
    <!-- Dachgeschossdecke -->
    <div class="measure-card" 
         *ngIf="measurementVisibility['dachgeschossdecke']"
         [class.editing]="isEditing"
         (click)="toggleMeasurement('dachgeschossdecke')">
      <div class="measure-icon attic-floor-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M8,32L32,12L56,32"/>
          <path d="M16,32h32"/>
          <path d="M18,32v8 M22,32v8 M26,32v8 M30,32v8 M34,32v8 M38,32v8 M42,32v8 M46,32v8"/>
          <path d="M16,40h32"/>
          <path d="M20,40v4 M28,40v4 M36,40v4 M44,40v4"/>
        </svg>
      </div>
      <div class="measure-content">
        <h3>Dachgeschossdecke</h3>
        <p>
          Eine gedämmte Dachgeschossdecke bietet mehrere Vorteile, vor allem in Bezug auf Energieeffizienz und 
          Wohnkomfort. Sie reduziert Wärmeverluste, senkt Heizkosten und verbessert das Raumklima. 
          Zusätzlich kann sie auch den Schallschutz verbessern.
        </p>
      </div>
      <div *ngIf="isEditing" class="edit-toggle-indicator">✓</div>
    </div>
    
    <!-- Dachfenster -->
    <div class="measure-card" 
         *ngIf="measurementVisibility['dachfenster']"
         [class.editing]="isEditing"
         (click)="toggleMeasurement('dachfenster')">
      <div class="measure-icon skylight-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M8,32L32,12L56,32"/>
          <rect x="24" y="20" width="16" height="12" rx="1" ry="1" transform="rotate(15 32 26)"/>
          <path d="M28,24l8,4 M28,28l8,4"/>
          <circle cx="32" cy="8" r="3"/>
          <path d="M32,11v2 M26,9l1.5,1.5 M38,9l-1.5,1.5"/>
          <path d="M20,38v8 M44,38v8"/>
        </svg>
      </div>
      <div class="measure-content">
        <h3>Dachfenster</h3>
        <p>
          Neue Dachfenster verbessern die Wärmedämmung, was zu geringeren Heizkosten führt, und 
          ermöglichen eine bessere Belüftung. Zudem lassen sie mehr Tageslicht in den Raum. Sonnen- 
          und Hitzeschutz sowie Smart-Home-Integration erhöhen den Wohnkomfort.
        </p>
      </div>
      <div *ngIf="isEditing" class="edit-toggle-indicator">✓</div>
    </div>
    
    <!-- Photovoltaik -->
    <div class="measure-card" 
         *ngIf="measurementVisibility['photovoltaik']"
         [class.editing]="isEditing"
         (click)="toggleMeasurement('photovoltaik')">
      <div class="measure-icon solar-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <rect x="16" y="20" width="32" height="24" rx="1" ry="1"/>
          <path d="M16,32h32 M24,20v24 M32,20v24 M40,20v24"/>
          <path d="M10,47h44 M12,47l2-3 M52,47l-2-3"/>
          <circle cx="32" cy="12" r="4"/>
          <path d="M32,16v4 M24,14l2,2 M40,14l-2,2 M22,22l2-2 M42,22l-2-2"/>
        </svg>
      </div>
      <div class="measure-content">
        <h3>Photovoltaik</h3>
        <p>
          Mit einer eigenen Photovoltaikanlage <strong>können Sie – besonders in Verbindung mit einem Stromspeicher – ihre 
          Autarkie erhöhen und so unabhängiger von den Stromanbietern werden</strong>. Zusätzlich können Sie sicher gehen, dass 
          Ihr Strom zu 100% erneuerbar erzeugt wurde und Sie sehr viele Energiekosten einsparen.
        </p>
      </div>
      <div *ngIf="isEditing" class="edit-toggle-indicator">✓</div>
    </div>
  </div>
  
  <!-- Climate Contribution Section - No editing functionality -->
  <div class="climate-contribution">
    <h2>Ihr Beitrag zum Klimaschutz: Ihre Einsparungen entsprechen ...</h2>
    
    <div class="benefits-icons">
      <!-- Flights -->
      <div class="benefit-icon">
        <div class="icon">✈️</div>
        <div class="benefit-text">5 Flüge</div>
        <div class="benefit-description">Frankfurt-New York</div>
      </div>
      
      <!-- Kilometers -->
      <div class="benefit-icon">
        <div class="icon">🚗</div>
        <div class="benefit-text">118.000</div>
        <div class="benefit-description">Autokilometer</div>
      </div>
      
      <!-- Trees -->
      <div class="benefit-icon">
        <div class="icon">🌳</div>
        <div class="benefit-text">566 Bäume,</div>
        <div class="benefit-description">die jähr. CO2 binden</div>
      </div>
    </div>
  </div>
</div>